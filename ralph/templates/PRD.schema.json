{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Ralph PRD Schema",
  "description": "Product Requirements Document schema for Ralph autonomous coding",
  "type": "object",
  "required": ["name", "description", "max_iterations", "verify", "tasks", "guardrails"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "name": {
      "type": "string",
      "description": "Project name",
      "minLength": 1
    },
    "description": {
      "type": "string",
      "description": "Brief overview of the project"
    },
    "created": {
      "type": "string",
      "description": "Creation date (YYYY-MM-DD)",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
    },
    "updated": {
      "type": "string",
      "description": "Last update date (YYYY-MM-DD)",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
    },
    "max_iterations": {
      "type": "integer",
      "description": "Maximum iterations before stopping",
      "minimum": 1,
      "default": 50
    },
    "verify": {
      "type": "object",
      "description": "Commands to verify task completion",
      "properties": {
        "test": {
          "$ref": "#/definitions/verifyCommand"
        },
        "lint": {
          "$ref": "#/definitions/verifyCommand"
        },
        "build": {
          "$ref": "#/definitions/verifyCommand"
        },
        "e2e": {
          "$ref": "#/definitions/verifyCommand"
        },
        "typecheck": {
          "$ref": "#/definitions/verifyCommand"
        }
      }
    },
    "goals": {
      "type": "array",
      "description": "Primary goals this project should achieve",
      "items": { "type": "string" }
    },
    "non_goals": {
      "type": "array",
      "description": "Explicitly out of scope items",
      "items": { "type": "string" }
    },
    "constraints": {
      "type": "object",
      "description": "Project constraints",
      "properties": {
        "technology": {
          "type": "array",
          "items": { "type": "string" }
        },
        "requirements": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "tasks": {
      "type": "array",
      "description": "List of tasks to complete",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/task"
      }
    },
    "guardrails": {
      "type": "array",
      "description": "Rules and constraints the agent must follow",
      "items": { "type": "string" }
    },
    "notes": {
      "type": "string",
      "description": "Additional context or notes"
    }
  },
  "definitions": {
    "verifyCommand": {
      "type": "object",
      "required": ["command"],
      "properties": {
        "command": {
          "type": "string",
          "description": "Shell command to run"
        },
        "description": {
          "type": "string",
          "description": "What this verification does"
        }
      }
    },
    "task": {
      "type": "object",
      "required": ["id", "name", "description", "status", "success_criteria"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique task identifier",
          "pattern": "^[0-9]+$"
        },
        "name": {
          "type": "string",
          "description": "Short task name",
          "minLength": 1
        },
        "description": {
          "type": "string",
          "description": "What needs to be done"
        },
        "status": {
          "type": "string",
          "enum": ["pending", "in_progress", "done", "blocked"],
          "description": "Current task status"
        },
        "priority": {
          "type": "integer",
          "description": "Task priority (lower = higher priority)",
          "minimum": 1
        },
        "requirements": {
          "type": "object",
          "properties": {
            "functional": {
              "type": "array",
              "items": { "type": "string" }
            },
            "non_functional": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        },
        "success_criteria": {
          "type": "array",
          "description": "Criteria that must ALL be true for task completion",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/successCriterion"
          }
        },
        "notes": {
          "type": "string",
          "description": "Additional task notes"
        }
      }
    },
    "successCriterion": {
      "type": "object",
      "required": ["id", "description", "verified"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Criterion ID (e.g., '1.1', '2.3')",
          "pattern": "^[0-9]+\\.[0-9]+$"
        },
        "description": {
          "type": "string",
          "description": "What must be true - must be objectively verifiable"
        },
        "verified": {
          "type": "boolean",
          "description": "Whether this criterion has been verified",
          "default": false
        },
        "verification": {
          "type": "string",
          "description": "How to verify this criterion (command or check)"
        }
      }
    }
  }
}
